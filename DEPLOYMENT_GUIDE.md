# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã –ê–≥—Ä–æ–î–∞–Ω–Ω—ã–µ –ö–ó

**–í–µ—Ä—Å–∏—è:** 2.0
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 25 –æ–∫—Ç—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** Production Ready

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
2. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è-–∫-—Å–∏—Å—Ç–µ–º–µ)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
4. [–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π](#–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ-–º–∏–≥—Ä–∞—Ü–∏–π)
5. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Streamlit Cloud](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ-–Ω–∞-streamlit-cloud)
6. [–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞](#—Å–æ–∑–¥–∞–Ω–∏–µ-–ø–µ—Ä–≤–æ–≥–æ-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
7. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏)
8. [–ú—É–ª—å—Ç–∏—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞](#–º—É–ª—å—Ç–∏—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω–∞—è-—Å–∏—Å—Ç–µ–º–∞)
9. [Troubleshooting](#troubleshooting)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/YergZakon/sbor_apk.git
cd sbor_apk

# 2. –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env —Å DATABASE_URL

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
streamlit run app.py
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–∞ http://localhost:8501

---

## üíª –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **Python:** 3.9+
- **RAM:** 512 MB
- **Disk:** 100 MB
- **PostgreSQL:** 12+ (Supabase —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```
streamlit>=1.28.0
pandas>=2.0.0
sqlalchemy>=2.0.0
psycopg2-binary>=2.9.0
python-dotenv>=1.0.0
plotly>=5.14.0
folium>=0.14.0
streamlit-folium>=0.13.0
openpyxl>=3.1.0
```

---

## üóÑÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –í–∞—Ä–∏–∞–Ω—Ç 1: Supabase (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)

1. **–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç:**
   - –ó–∞–π—Ç–∏ –Ω–∞ https://supabase.com
   - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
   - –í—ã–±—Ä–∞—Ç—å —Ä–µ–≥–∏–æ–Ω (–±–ª–∏–∂–∞–π—à–∏–π –∫ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω—É)
   - –ó–∞–¥–∞—Ç—å –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å

2. **–ü–æ–ª—É—á–∏—Ç—å Database URL:**
   ```
   Project Settings ‚Üí Database ‚Üí Connection String ‚Üí URI

   –§–æ—Ä–º–∞—Ç:
   postgresql://postgres:[PASSWORD]@[HOST]:5432/postgres
   ```

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª:**
   ```bash
   DATABASE_URL=postgresql://postgres:your_password@db.xxx.supabase.co:5432/postgres
   ```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL

```bash
# –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
createdb farm_data

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env
DATABASE_URL=postgresql://user:password@localhost:5432/farm_data
```

---

## üì¶ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

### –í–ê–ñ–ù–û: –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –°–¢–†–û–ì–û –ø–æ –ø–æ—Ä—è–¥–∫—É!

#### –ú–∏–≥—Ä–∞—Ü–∏—è 002: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤

**–§–∞–π–ª:** `migrations/002_add_implement_types.sql`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–∏–ø—ã –∞–≥—Ä–µ–≥–∞—Ç–æ–≤: header (–∂–∞—Ç–∫–∏), mower (–∫–æ—Å–∏–ª–∫–∏), baler (–ø—Ä–µ—Å—Å-–ø–æ–¥–±–æ—Ä—â–∏–∫–∏)

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `migrations/002_add_implement_types.sql`
3. –í—Å—Ç–∞–≤—å—Ç–µ –∏ –Ω–∞–∂–º–∏—Ç–µ RUN

```sql
BEGIN;

ALTER TABLE implements DROP CONSTRAINT IF EXISTS implements_implement_type_check;

ALTER TABLE implements ADD CONSTRAINT implements_implement_type_check
CHECK (implement_type IN (
    'seeder', 'planter', 'plow', 'cultivator', 'harrow', 'disc',
    'deep_loosener', 'roller', 'sprayer_trailer', 'fertilizer_spreader',
    'stubble_breaker', 'snow_plow',
    'header',  -- NEW
    'mower',   -- NEW
    'baler',   -- NEW
    'other'
));

COMMIT;
```

#### –ú–∏–≥—Ä–∞—Ü–∏—è 003: –°–ø–æ—Å–æ–± –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –¥–µ—Å–∏–∫–∞—Ü–∏–∏

**–§–∞–π–ª:** `migrations/003_add_desiccation_application_method.sql`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `application_method` –≤ —Ç–∞–±–ª–∏—Ü—É `desiccation_details`

```sql
BEGIN;

ALTER TABLE desiccation_details
ADD COLUMN IF NOT EXISTS application_method VARCHAR(100);

COMMENT ON COLUMN desiccation_details.application_method
IS '–°–ø–æ—Å–æ–± –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (–ù–∞–∑–µ–º–Ω–æ–µ/–ê–≤–∏–∞—Ü–∏–æ–Ω–Ω–æ–µ –æ–ø—Ä—ã—Å–∫–∏–≤–∞–Ω–∏–µ)';

COMMIT;
```

#### –ú–∏–≥—Ä–∞—Ü–∏—è 004: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π

**–§–∞–π–ª:** `migrations/004_add_missing_operation_fields.sql`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –î–æ–±–∞–≤–ª—è–µ—Ç `soil_moisture_before` –≤ `irrigation_details`
- –î–æ–±–∞–≤–ª—è–µ—Ç `snow_depth_cm`, `number_of_passes` –≤ `snow_retention_details`
- –î–æ–±–∞–≤–ª—è–µ—Ç `number_of_treatments` –≤ `fallow_details`
- –î–æ–±–∞–≤–ª—è–µ—Ç `soil_moisture` –≤ `tillage_details`

```sql
BEGIN;

-- irrigation_details
ALTER TABLE irrigation_details
ADD COLUMN IF NOT EXISTS soil_moisture_before FLOAT;

-- snow_retention_details
ALTER TABLE snow_retention_details
ADD COLUMN IF NOT EXISTS snow_depth_cm FLOAT;

ALTER TABLE snow_retention_details
ADD COLUMN IF NOT EXISTS number_of_passes INTEGER;

-- fallow_details
ALTER TABLE fallow_details
ADD COLUMN IF NOT EXISTS number_of_treatments INTEGER;

-- tillage_details
ALTER TABLE tillage_details
ADD COLUMN IF NOT EXISTS soil_moisture VARCHAR(50);

COMMIT;
```

#### –ú–∏–≥—Ä–∞—Ü–∏—è 005: –ú—É–ª—å—Ç–∏—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

**–§–∞–π–ª:** `migrations/005_add_user_farms_table.sql`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `user_farms` –¥–ª—è —Å–≤—è–∑–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ö–æ–∑—è–π—Å—Ç–≤–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∏—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–≤—è–∑–∏ –∏–∑ `users.farm_id`
- –î–æ–±–∞–≤–ª—è–µ—Ç —Ä–æ–ª–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ö–æ–∑—è–π—Å—Ç–≤–∞ (admin, manager, viewer)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ö–æ–∑—è–π—Å—Ç–≤–∞ (is_primary)

```sql
BEGIN;

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE IF NOT EXISTS user_farms (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    farm_id INTEGER NOT NULL REFERENCES farms(id) ON DELETE CASCADE,
    role VARCHAR(20) DEFAULT 'viewer',
    is_primary BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT uq_user_farm UNIQUE (user_id, farm_id)
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX IF NOT EXISTS idx_user_farms_user_id ON user_farms(user_id);
CREATE INDEX IF NOT EXISTS idx_user_farms_farm_id ON user_farms(farm_id);
CREATE INDEX IF NOT EXISTS idx_user_farms_is_primary ON user_farms(user_id, is_primary)
WHERE is_primary = TRUE;

-- –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
INSERT INTO user_farms (user_id, farm_id, role, is_primary)
SELECT id, farm_id, role, TRUE
FROM users
WHERE farm_id IS NOT NULL
ON CONFLICT (user_id, farm_id) DO NOTHING;

COMMIT;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–π:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã user_farms
SELECT COUNT(*) as user_farm_links FROM user_farms;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
SELECT column_name, data_type
FROM information_schema.columns
WHERE table_name = 'irrigation_details'
AND column_name = 'soil_moisture_before';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
SELECT UNNEST(enum_range(NULL::implement_type)) AS implement_types;
```

---

## ‚òÅÔ∏è –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Streamlit Cloud

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã
git add .
git commit -m "Ready for deployment"
git push origin main
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Streamlit Cloud

1. –ó–∞–π—Ç–∏ –Ω–∞ https://share.streamlit.io
2. –ù–∞–∂–∞—Ç—å **New app**
3. –í—ã–±—Ä–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `YergZakon/sbor_apk`
4. Branch: `main`
5. Main file: `app.py`
6. –ù–∞–∂–∞—Ç—å **Deploy**

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Secrets

–í Streamlit Cloud ‚Üí App settings ‚Üí Secrets:

```toml
DATABASE_URL = "postgresql://postgres:password@db.xxx.supabase.co:5432/postgres"
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è secrets –Ω–∞–∂–∞—Ç—å **Reboot app**

---

## üë§ –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ SQL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```sql
-- –í—Å—Ç–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é –≤ –±–∞–∑—É
INSERT INTO users (
    username,
    email,
    password_hash,
    full_name,
    role,
    is_active
) VALUES (
    'admin',
    'admin@example.com',
    'pbkdf2:sha256:600000$...',  -- –•—ç—à –ø–∞—Ä–æ–ª—è
    '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –°–∏—Å—Ç–µ–º—ã',
    'admin',
    TRUE
);
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è)

1. –ü–µ—Ä–≤—ã–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–¥–º–∏–Ω–æ–º
2. –ò–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–¥–º–∏–Ω —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ —á–µ—Ä–µ–∑: –ê–¥–º–∏–Ω–∫–∞ ‚Üí –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏

–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç 16 —Å–ø—Ä–∞–≤–æ—á–Ω—ã—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:

### –°–µ–ª—å—Å–∫–æ—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏:
1. **crops.json** - –ö—É–ª—å—Ç—É—Ä—ã –∏ —Å–æ—Ä—Ç–∞
2. **diseases.json** - –ë–æ–ª–µ–∑–Ω–∏ —Ä–∞—Å—Ç–µ–Ω–∏–π
3. **pests.json** - –í—Ä–µ–¥–∏—Ç–µ–ª–∏
4. **weeds.json** - –°–æ—Ä–Ω—è–∫–∏
5. **soil_types.json** - –¢–∏–ø—ã –ø–æ—á–≤

### –¢–µ—Ö–Ω–∏–∫–∞:
6. **tractors.json** - –¢—Ä–∞–∫—Ç–æ—Ä—ã
7. **combines.json** - –ö–æ–º–±–∞–π–Ω—ã
8. **implements.json** - –ê–≥—Ä–µ–≥–∞—Ç—ã

### –ê–≥—Ä–æ—Ö–∏–º–∏—è:
9. **pesticides.json** - –ü–µ—Å—Ç–∏—Ü–∏–¥—ã
10. **fertilizers.json** - –£–¥–æ–±—Ä–µ–Ω–∏—è
11. **active_ingredients.json** - –î–µ–π—Å—Ç–≤—É—é—â–∏–µ –≤–µ—â–µ—Å—Ç–≤–∞
12. **pesticide_classes.json** - –ö–ª–∞—Å—Å—ã –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤
13. **fertilizer_categories.json** - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–¥–æ–±—Ä–µ–Ω–∏–π
14. **desiccation_products.json** - –î–µ—Å–∏–∫–∞–Ω—Ç—ã

### –ü—Ä–æ—á–µ–µ:
15. **countries.json** - –°—Ç—Ä–∞–Ω—ã –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è
16. **seed_reproductions.json** - –†–µ–ø—Ä–æ–¥—É–∫—Ü–∏–∏ —Å–µ–º—è–Ω

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤:

**–ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤):**
- –°—Ç—Ä–∞–Ω–∏—Ü–∞: **üìö –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏** (pages/99_üìö_References.py)
- 4 –≤–∫–ª–∞–¥–∫–∏: –ü—Ä–æ—Å–º–æ—Ç—Ä, –î–æ–±–∞–≤–∏—Ç—å, –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç

**–ß–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã:**
```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å JSON —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é
nano data/crops.json

# –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add data/
git commit -m "Update crop varieties"
git push
```

---

## üè¢ –ú—É–ª—å—Ç–∏—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

**–¢–∞–±–ª–∏—Ü–∞ `user_farms`:**
- –°–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ö–æ–∑—è–π—Å—Ç–≤–∞–º–∏
- –†–æ–ª–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ö–æ–∑—è–π—Å—Ç–≤–∞: `admin`, `manager`, `viewer`
- –§–ª–∞–≥ `is_primary` –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ö–æ–∑—è–π—Å—Ç–≤–∞

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —Ö–æ–∑—è–π—Å—Ç–≤–∞:

1. **–ê–¥–º–∏–Ω–∫–∞** ‚Üí **üè¢ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —Ö–æ–∑—è–π—Å—Ç–≤–∞**
2. –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –î–æ–±–∞–≤–∏—Ç—å —Ö–æ–∑—è–π—Å—Ç–≤–æ —Å —Ä–æ–ª—å—é
4. –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø–µ—Ä–≤–∏—á–Ω–æ–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –†–æ–ª–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ö–æ–∑—è–π—Å—Ç–≤–∞:

| –†–æ–ª—å | –ü—Ä–∞–≤–∞ |
|------|-------|
| **üëë admin** | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ö–æ–∑—è–π—Å—Ç–≤—É |
| **üëî manager** | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö |
| **üëÅÔ∏è viewer** | –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä |

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ö–æ–∑—è–π—Å—Ç–≤–∞–º–∏:

–ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ö–æ–∑—è–π—Å—Ç–≤, –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –ø–æ—è–≤–∏—Ç—Å—è —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ö–æ–∑—è–π—Å—Ç–≤–∞.

---

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

**–°–∏–º–ø—Ç–æ–º—ã:**
```
sqlalchemy.exc.OperationalError: could not connect to server
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DATABASE_URL –≤ secrets/env
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall –≤ Supabase (—Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ IP –∏–ª–∏ 0.0.0.0/0)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å (—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –Ω—É–∂–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å)

### –ü—Ä–æ–±–ª–µ–º–∞: IntegrityError –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—è

**–°–∏–º–ø—Ç–æ–º—ã:**
```
IntegrityError: duplicate key value violates unique constraint "fields_field_code_key"
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º –∫–æ–º–º–∏—Ç–µ (dbafba1)
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Streamlit Cloud

### –ü—Ä–æ–±–ª–µ–º–∞: DetachedInstanceError

**–°–∏–º–ø—Ç–æ–º—ã:**
```
sqlalchemy.exc.InvalidRequestError: Instance is not bound to a Session
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–º–º–∏—Ç–µ 7d3f99d
- –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ —Å GitHub

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
```
ERROR: relation "user_farms" already exists
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ:
   ```sql
   SELECT * FROM information_schema.tables WHERE table_name = 'user_farms';
   ```
2. –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –º–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
3. –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –æ—Ç–∫–∞—Ç, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `*_ROLLBACK.sql` —Ñ–∞–π–ª

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –º–æ–≥—É —É–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ

**–°–∏–º–ø—Ç–æ–º—ã:**
```
‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ: –µ—Å—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (5 –æ–ø–µ—Ä–∞—Ü–∏–π)
```

**–†–µ—à–µ–Ω–∏–µ:**
- –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ!
- –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏—Ç–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø–æ–ª–µ–º
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ CASCADE –≤ SQL (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**GitHub:** https://github.com/YergZakon/sbor_apk
**Issues:** https://github.com/YergZakon/sbor_apk/issues
**Production URL:** https://sbor-apk.streamlit.app

---

## üìù Changelog

### Version 2.0 (25 –æ–∫—Ç—è–±—Ä—è 2025)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –º—É–ª—å—Ç–∏—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ 7 –Ω–æ–≤—ã—Ö —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª–µ–π
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è field_code
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ 002-005

### Version 1.0 (22 –æ–∫—Ç—è–±—Ä—è 2025)
- ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ 10 —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ —Ç–µ—Ö–Ω–∏–∫–∏
- ‚úÖ –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

---

**–ì–æ—Ç–æ–≤—ã –∫ –¥–µ–ø–ª–æ—é!** üöÄ
