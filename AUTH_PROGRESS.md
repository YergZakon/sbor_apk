# üîê –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 2025-10-15
**–ö–æ–º–º–∏—Ç:** b3d1c9e
**–°—Ç–∞—Ç—É—Å:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ (2/12 —Å—Ç—Ä–∞–Ω–∏—Ü –≥–æ—Ç–æ–≤–æ)

---

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ö–µ–ª–ø–µ—Ä—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ä–æ–ª—è–º

–í [modules/auth.py](modules/auth.py) –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 204-283):

#### `filter_query_by_farm(query, model)`
**–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ö–æ–∑—è–π—Å—Ç–≤–∞–º:**

```python
def filter_query_by_farm(query, model):
    """
    –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –ø–æ —Ö–æ–∑—è–π—Å—Ç–≤—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    - –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö —Ö–æ–∑—è–π—Å—Ç–≤
    - –§–µ—Ä–º–µ—Ä/Viewer –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ —Å–≤–æ–µ–≥–æ —Ö–æ–∑—è–π—Å—Ç–≤–∞
    - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—é—Ç –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    """
    user = get_current_user()

    if not user:
        return query.filter(False)  # –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

    # –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –≤—Å—ë
    if user.get("role") == "admin":
        return query

    # –§–µ—Ä–º–µ—Ä –∏ Viewer –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—ë —Ö–æ–∑—è–π—Å—Ç–≤–æ
    farm_id = user.get("farm_id")
    if not farm_id:
        return query.filter(False)

    if hasattr(model, 'farm_id'):
        return query.filter(model.farm_id == farm_id)
    else:
        return query
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –ë—ã–ª–æ:
farms = db.query(Farm).all()
fields = db.query(Field).filter(Field.farm_id == farm_id).all()

# –°—Ç–∞–ª–æ:
farms = filter_query_by_farm(db.query(Farm), Farm).all()
fields = filter_query_by_farm(db.query(Field), Field).all()
```

#### –î—Ä—É–≥–∏–µ —Ö–µ–ª–ø–µ—Ä—ã:

- **`get_user_farm_id()`** - –ø–æ–ª—É—á–∏—Ç—å ID —Ö–æ–∑—è–π—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **`can_edit_data()`** - –º–æ–∂–µ—Ç –ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (admin + farmer)
- **`can_delete_data()`** - –º–æ–∂–µ—Ç –ª–∏ —É–¥–∞–ª—è—Ç—å (—Ç–æ–ª—å–∫–æ admin)
- **`require_farm_binding()`** - —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Ö–æ–∑—è–π—Å—Ç–≤—É (–∫—Ä–æ–º–µ –∞–¥–º–∏–Ω–æ–≤)

### 2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ Dashboard (‚úÖ –ì–û–¢–û–í–û)

–§–∞–π–ª: [pages/1_üè†_Dashboard.py](pages/1_üè†_Dashboard.py)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `modules.auth`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `require_auth()` –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω caption —Å –∏–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ–±–µ—Ä–Ω—É—Ç—ã –≤ `filter_query_by_farm()`:
  - –ü–æ–¥—Å—á–µ—Ç —Ö–æ–∑—è–π—Å—Ç–≤, –ø–æ–ª–µ–π, –æ–ø–µ—Ä–∞—Ü–∏–π
  - –ê–≥—Ä–æ—Ö–∏–º–∏—á–µ—Å–∫–∏–µ –∞–Ω–∞–ª–∏–∑—ã
  - –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å JOIN)
  - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ö–æ–∑—è–π—Å—Ç–≤–µ
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ: **—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**
```python
# –ò–º–ø–æ—Ä—Ç—ã
from modules.auth import require_auth, filter_query_by_farm, get_user_display_name

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
require_auth()

# –ó–∞–≥–æ–ª–æ–≤–æ–∫
st.title("üè† Dashboard - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è")
st.caption(f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, **{get_user_display_name()}**!")

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
farms_count = filter_query_by_farm(db.query(Farm), Farm).count()
fields_count = filter_query_by_farm(db.query(Field), Field).count()
operations_count = filter_query_by_farm(db.query(Operation), Operation).count()
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ Farm Setup (‚úÖ –ì–û–¢–û–í–û)

–§–∞–π–ª: [pages/0_üè¢_Farm_Setup.py](pages/0_üè¢_Farm_Setup.py)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `modules.auth`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `require_auth()` –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ö–æ–∑—è–π—Å—Ç–≤–∞ (dropdown –≤—ã–±–æ—Ä)
- ‚úÖ –§–µ—Ä–º–µ—Ä –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
- ‚úÖ –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —Å `can_edit_data()`
- ‚úÖ –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —Å `can_delete_data()`
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ: **—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**
```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ö–æ–∑—è–π—Å—Ç–≤–∞ —Å —É—á–µ—Ç–æ–º —Ä–æ–ª–∏
user = get_current_user()
if is_admin():
    # –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å —Ö–æ–∑—è–π—Å—Ç–≤–∞
    all_farms = db.query(Farm).all()
    selected_farm_name = st.selectbox(
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",
        options=["–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ"] + list(farm_names.keys())
    )
    existing_farm = db.query(Farm).filter(Farm.id == farm_id).first()
else:
    # –§–µ—Ä–º–µ—Ä –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
    existing_farm = filter_query_by_farm(db.query(Farm), Farm).first()

# –ó–∞—â–∏—Ç–∞ –∫–Ω–æ–ø–æ–∫
if can_edit_data():
    if st.button("‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ö–æ–∑—è–π—Å—Ç–≤–∞"):
        st.session_state.edit_mode = True
else:
    st.info("‚ÑπÔ∏è –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ")

if can_delete_data():
    # –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
```

### 4. –°–æ–∑–¥–∞–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π guide (‚úÖ –ì–û–¢–û–í–û)

–§–∞–π–ª: [AUTH_INTEGRATION_GUIDE.md](AUTH_INTEGRATION_GUIDE.md)

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- üìã –ß–µ–∫-–ª–∏—Å—Ç –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (2 –≥–æ—Ç–æ–≤–æ, 10 –æ—Å—Ç–∞–ª–æ—Å—å)
- üîß –ü–æ—à–∞–≥–æ–≤—ã–π —à–∞–±–ª–æ–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- üìù –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –∏–∑ –≥–æ—Ç–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- üéØ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- üìö –°–ø—Ä–∞–≤–∫–∞ –ø–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º

### 5. –ü—É—à –≤ GitHub (‚úÖ –ì–û–¢–û–í–û)

**–ö–æ–º–º–∏—Ç:** `b3d1c9e`
```
feat: add role-based data filtering helpers and integrate auth into Dashboard and Farm Setup

- Added filter_query_by_farm() for automatic role-based filtering
- Added can_edit_data(), can_delete_data() permission helpers
- Added require_farm_binding() to ensure users are bound to farms
- Integrated full authentication into Dashboard page
- Integrated full authentication into Farm Setup page
- Created comprehensive AUTH_INTEGRATION_GUIDE.md with patterns for remaining pages

Status: 2/12 pages integrated, 10 remaining
```

---

## ‚è≥ –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å

### –°—Ç—Ä–∞–Ω–∏—Ü—ã —Ç—Ä–µ–±—É—é—â–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (10 —à—Ç):

1. **[pages/2_üå±_Fields.py](pages/2_üå±_Fields.py)** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è–º–∏
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π
   - –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
   - –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

2. **[pages/3_üìù_Journal.py](pages/3_üìù_Journal.py)** - –ñ—É—Ä–Ω–∞–ª –æ–ø–µ—Ä–∞—Ü–∏–π
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ–ª—è–º —Ö–æ–∑—è–π—Å—Ç–≤–∞
   - JOIN —Å Field –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
   - –≠–∫—Å–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö

3. **[pages/4_üåæ_Sowing.py](pages/4_üåæ_Sowing.py)** - –£—á–µ—Ç –ø–æ—Å–µ–≤–∞
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –¥–ª—è –≤—ã–±–æ—Ä–∞
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–µ–≤–æ–≤
   - –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞

4. **[pages/5_üíä_Fertilizers.py](pages/5_üíä_Fertilizers.py)** - –£—á–µ—Ç —É–¥–æ–±—Ä–µ–Ω–∏–π
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –¥–ª—è –≤—ã–±–æ—Ä–∞
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–Ω–µ—Å–µ–Ω–∏—è
   - –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞

5. **[pages/6_üõ°Ô∏è_Pesticides.py](pages/6_üõ°Ô∏è_Pesticides.py)** - –£—á–µ—Ç –ø–µ—Å—Ç–∏—Ü–∏–¥–æ–≤
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –¥–ª—è –≤—ã–±–æ—Ä–∞
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ–±—Ä–∞–±–æ—Ç–æ–∫
   - –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞

6. **[pages/7_üêõ_Phytosanitary.py](pages/7_üêõ_Phytosanitary.py)** - –§–∏—Ç–æ—Å–∞–Ω–∏—Ç–∞—Ä–∏—è
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∏ –ø–æ –ø–æ–ª—è–º
   - –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞

7. **[pages/8_üöú_Harvest.py](pages/8_üöú_Harvest.py)** - –£—á–µ—Ç —É–±–æ—Ä–∫–∏
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –¥–ª—è –≤—ã–±–æ—Ä–∞
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —É–±–æ—Ä–∫–∏
   - –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞

8. **[pages/9_üß™_Agrochemistry.py](pages/9_üß™_Agrochemistry.py)** - –ê–≥—Ä–æ—Ö–∏–º–∏—è
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑—ã –ø–æ –ø–æ–ª—è–º
   - –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞

9. **[pages/11_üå§Ô∏è_Weather.py](pages/11_üå§Ô∏è_Weather.py)** - –ü–æ–≥–æ–¥–∞
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –º–µ—Ç–µ–æ–¥–∞–Ω–Ω—ã–µ –ø–æ —Ö–æ–∑—è–π—Å—Ç–≤—É
   - –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞

10. **[pages/15_üì•_Import.py](pages/15_üì•_Import.py)** - –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
    - –ò–º–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ –≤ —Å–≤–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
    - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –ø–æ–ª–µ–π
    - **–í–ê–ñ–ù–û:** –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –ª—é–±–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ

---

## üìã –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –∫–∞–∂–¥–æ–π –∏–∑ 10 –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü:

### –®–∞–≥ 1: –ò–º–ø–æ—Ä—Ç—ã
```python
from modules.auth import (
    require_auth,
    require_farm_binding,
    filter_query_by_farm,
    get_user_display_name,
    can_edit_data,
    can_delete_data
)
```

### –®–∞–≥ 2: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```python
st.set_page_config(...)

# –¢—Ä–µ–±—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ –ø—Ä–∏–≤—è–∑–∫—É –∫ —Ö–æ–∑—è–π—Å—Ç–≤—É
require_auth()
require_farm_binding()

st.title("...")
st.caption(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: **{get_user_display_name()}**")
```

### –®–∞–≥ 3: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
```python
# –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Ç–∞–±–ª–∏—Ü–∞–º —Å farm_id –æ–±–µ—Ä–Ω—É—Ç—å:
fields = filter_query_by_farm(db.query(Field), Field).all()
operations = filter_query_by_farm(db.query(Operation), Operation).all()

# JOIN –∑–∞–ø—Ä–æ—Å—ã:
data = filter_query_by_farm(
    db.query(Operation, Field).join(Field),
    Field
).all()
```

### –®–∞–≥ 4: –ó–∞—â–∏—Ç–∞ —Ñ–æ—Ä–º
```python
if can_edit_data():
    st.markdown("### ‚ûï –î–æ–±–∞–≤–∏—Ç—å...")
    with st.form("..."):
        # —Ñ–æ—Ä–º–∞
else:
    st.info("‚ÑπÔ∏è –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ")

# –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è:
if can_delete_data():
    delete_btn = st.form_submit_button("üóëÔ∏è –£–¥–∞–ª–∏—Ç—å")
```

### –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –í–æ–π—Ç–∏ –∫–∞–∫ –§–µ—Ä–º–µ—Ä 1 - –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- [ ] –í–æ–π—Ç–∏ –∫–∞–∫ –§–µ—Ä–º–µ—Ä 2 - –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ (–æ—Ç–ª–∏—á–Ω—ã–µ –æ—Ç –§–µ—Ä–º–µ—Ä–∞ 1)
- [ ] –í–æ–π—Ç–∏ –∫–∞–∫ –ê–¥–º–∏–Ω - –≤–∏–¥–Ω—ã –í–°–ï –¥–∞–Ω–Ω—ã–µ
- [ ] –í–æ–π—Ç–∏ –∫–∞–∫ Viewer - –Ω–µ—Ç –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üöÄ –ü–ª–∞–Ω –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä—ã—Ç—å [AUTH_INTEGRATION_GUIDE.md](AUTH_INTEGRATION_GUIDE.md)
2. –î–ª—è –∫–∞–∂–¥–æ–π –∏–∑ 10 —Å—Ç—Ä–∞–Ω–∏—Ü:
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –®–∞–≥–∏ 1-4 –∏–∑ —á–µ–∫-–ª–∏—Å—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å: `python -m py_compile pages/X_....py`
   - –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å: `git add pages/X_... && git commit -m "feat: integrate auth into X page"`
3. –ü—É—à–Ω—É—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: `git push`
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ
5. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Streamlit Cloud

**–í—Ä–µ–º—è:** ~2-3 —á–∞—Å–∞

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [add_auth_to_pages.py](add_auth_to_pages.py)
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å: `python add_auth_to_pages.py`
3. –í—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
5. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å

**–í—Ä–µ–º—è:** ~1-2 —á–∞—Å–∞ (–Ω–æ —Ç—Ä–µ–±—É–µ—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ 2-3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –¥–µ–Ω—å
2. –¢—â–∞—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é
3. –î–µ–ø–ª–æ–∏—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ

**–í—Ä–µ–º—è:** ~3-5 –¥–Ω–µ–π

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```bash
# –ù–∞ production (Streamlit Cloud):
# –ú–µ—Ç–æ–¥ 1: –ß–µ—Ä–µ–∑ Supabase SQL
INSERT INTO users (username, email, hashed_password, full_name, role, is_active, farm_id, created_at)
VALUES
('admin', 'admin@agrodata.kz', '$2b$12$LQv3c1yqBwEHxPKCLEhAg.v5FAz6l7L3uTZfRW8dKfabc123ABC', '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', 'admin', true, NULL, NOW()),
('farmer1', 'farmer1@test.kz', '$2b$12$...', '–§–µ—Ä–º–µ—Ä 1', 'farmer', true, 1, NOW()),
('farmer2', 'farmer2@test.kz', '$2b$12$...', '–§–µ—Ä–º–µ—Ä 2', 'farmer', true, 2, NOW()),
('viewer1', 'viewer1@test.kz', '$2b$12$...', '–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å 1', 'viewer', true, 1, NOW());

# –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ UI —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ + SQL update role
```

### 2. –¢–µ—Å—Ç –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

| –î–µ–π—Å—Ç–≤–∏–µ | –§–µ—Ä–º–µ—Ä 1 | –§–µ—Ä–º–µ—Ä 2 | –ê–¥–º–∏–Ω | Viewer |
|----------|----------|----------|-------|--------|
| –í–∏–¥–∏—Ç –ø–æ–ª—è —Ö–æ–∑—è–π—Å—Ç–≤–∞ 1 | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ |
| –í–∏–¥–∏—Ç –ø–æ–ª—è —Ö–æ–∑—è–π—Å—Ç–≤–∞ 2 | ‚ùå | ‚úÖ | ‚úÖ | ‚ùå |
| –í–∏–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ö–æ–∑. 1 | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ |
| –í–∏–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ö–æ–∑. 2 | ‚ùå | ‚úÖ | ‚úÖ | ‚ùå |
| –ú–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| –ú–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å | ‚ùå | ‚ùå | ‚úÖ | ‚ùå |

### 3. –¢–µ—Å—Ç Dashboard
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–ª–∏ –≤—Å–µ—Ö –¥–ª—è –∞–¥–º–∏–Ω–∞)
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [ ] –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è

### 4. –¢–µ—Å—Ç –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ü–æ—Å–µ–≤: —Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è, –∏—Å—Ç–æ—Ä–∏—è —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è
- [ ] –£–¥–æ–±—Ä–µ–Ω–∏—è: —Ç–æ –∂–µ —Å–∞–º–æ–µ
- [ ] –ü–µ—Å—Ç–∏—Ü–∏–¥—ã: —Ç–æ –∂–µ —Å–∞–º–æ–µ
- [ ] –£–±–æ—Ä–∫–∞: —Ç–æ –∂–µ —Å–∞–º–æ–µ

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü:** 12
- **–ì–æ—Ç–æ–≤–æ:** 2 (17%)
- **–û—Å—Ç–∞–ª–æ—Å—å:** 10 (83%)
- **–ù–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:** 5
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** ~80 (–≤ modules/auth.py)
- **–ò–∑–º–µ–Ω–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 2 —Å—Ç—Ä–∞–Ω–∏—Ü—ã + 1 –º–æ–¥—É–ª—å + guide

---

## üéØ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –≤–Ω–∏–º–∞–Ω–∏—è

1. **JOIN –∑–∞–ø—Ä–æ—Å—ã:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª—å —Å `farm_id`
2. **–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏:** –ù–ï —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å (–∫—É–ª—å—Ç—É—Ä—ã, —É–¥–æ–±—Ä–µ–Ω–∏—è, –ø–µ—Å—Ç–∏—Ü–∏–¥—ã, etc.)
3. **Import:** –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –ª—é–±–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
4. **Viewer role:** –ù–µ –∑–∞–±—ã—Ç—å —É–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
5. **–°–∏–Ω—Ç–∞–∫—Å–∏—Å:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [AUTH_INTEGRATION_GUIDE.md](AUTH_INTEGRATION_GUIDE.md)
- **–ü—Ä–∏–º–µ—Ä—ã:** [pages/1_üè†_Dashboard.py](pages/1_üè†_Dashboard.py), [pages/0_üè¢_Farm_Setup.py](pages/0_üè¢_Farm_Setup.py)
- **API:** [modules/auth.py](modules/auth.py) —Å—Ç—Ä–æ–∫–∏ 204-283
- **Production Setup:** [PRODUCTION_SETUP.md](PRODUCTION_SETUP.md)

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è 10 —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –ø–æ —à–∞–±–ª–æ–Ω—É.
