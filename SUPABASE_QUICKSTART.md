# Supabase Quick Start - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## üöÄ –ó–∞ 5 –º–∏–Ω—É—Ç

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Supabase (1 –º–∏–Ω)

1. –û—Ç–∫—Ä–æ–π—Ç–µ `.env` —Ñ–∞–π–ª
2. –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
```env
DATABASE_URL=postgresql://postgres:[PASSWORD]@db.[PROJECT-REF].supabase.co:5432/postgres
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (1 –º–∏–Ω)

–û—Ç–∫—Ä–æ–π—Ç–µ **Supabase SQL Editor** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ quick_check.sql
```

–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç:
- ‚úÖ –ö–∞–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã –µ—Å—Ç—å (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 18)
- ‚úÖ –ö–∞–∫–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- ‚ö†Ô∏è –ï—Å—Ç—å –ª–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã –ë–ò–ù/username/email
- ‚ö†Ô∏è –ï—Å—Ç—å –ª–∏ —Å–∏—Ä–æ—Ç—Å–∫–∏–µ –∑–∞–ø–∏—Å–∏

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è (2 –º–∏–Ω)

**–ï—Å–ª–∏ –Ω–∞—à–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã**, —Å–Ω–∞—á–∞–ª–∞ –æ—á–∏—Å—Ç–∏—Ç–µ –∏—Ö:

```sql
-- –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –ë–ò–ù (–æ—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π)
DELETE FROM farms
WHERE id NOT IN (SELECT MIN(id) FROM farms GROUP BY bin);

-- –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã username
DELETE FROM users
WHERE id NOT IN (SELECT MIN(id) FROM users GROUP BY username);
```

**–ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:**

```sql
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ supabase_improvements.sql
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç (1 –º–∏–Ω)

–°–Ω–æ–≤–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `quick_check.sql` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å:
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ –î—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–µ—Ç
- ‚úÖ –°–∏—Ä–æ—Ç—Å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç

### –®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
streamlit run Home.py
```

–ì–æ—Ç–æ–≤–æ! üéâ

---

## üìã –ß—Ç–æ –±—ã–ª–æ —É–ª—É—á—à–µ–Ω–æ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `supabase_improvements.sql`:

### ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏
- `farms.bin` - –ë–ò–ù —Ö–æ–∑—è–π—Å—Ç–≤–∞ (UNIQUE)
- `users.username` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (UNIQUE)
- `users.email` - email (UNIQUE)
- `fields.field_code` - –∫–æ–¥ –ø–æ–ª—è (UNIQUE)

### ‚úÖ –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∫–ª—é—á–∏ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- `economic_data(field_id, year, crop)` - –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –ø–æ–ª–µ/–≥–æ–¥/–∫—É–ª—å—Ç—É—Ä—É
- `weather_data(farm_id, datetime)` - –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –≤—Ä–µ–º—è
- `satellite_data(field_id, acquisition_date, satellite_source)` - –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –¥–∞—Ç—É/–∏—Å—Ç–æ—á–Ω–∏–∫

### ‚úÖ 40+ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
- –ù–∞ `farm_id` –≤–æ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- –ù–∞ –¥–∞—Ç–∞—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ù–∞ —Ç–∏–ø–∞—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –î–ª—è –±—ã—Å—Ç—Ä—ã—Ö JOIN'–æ–≤

### ‚úÖ CHECK constraints (–≤–∞–ª–∏–¥–∞—Ü–∏—è)
- –ë–ò–ù = 12 —Å–∏–º–≤–æ–ª–æ–≤
- –ü–ª–æ—â–∞–¥–∏ >= 0
- –†–æ–ª—å –≤ ('admin', 'farmer', 'viewer')
- NDVI –º–µ–∂–¥—É -1 –∏ 1

### ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `updated_at`

### ‚úÖ CASCADE DELETE
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ö–æ–∑—è–π—Å—Ç–≤–∞ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### ‚úÖ Views (–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è)
- `v_fields_with_farms` - –ø–æ–ª—è —Å —Ö–æ–∑—è–π—Å—Ç–≤–∞–º–∏
- `v_operations_summary` - —Å–≤–æ–¥–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
- `v_users_with_farms` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ö–æ–∑—è–π—Å—Ç–≤–∞–º–∏
- `v_farm_statistics` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ö–æ–∑—è–π—Å—Ç–≤–∞–º

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –î—É–±–ª–∏–∫–∞—Ç—ã –ë–ò–ù

```sql
-- –ù–∞–π—Ç–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã
SELECT bin, COUNT(*), string_agg(name, ', ') AS farms
FROM farms
GROUP BY bin
HAVING COUNT(*) > 1;

-- –£–¥–∞–ª–∏—Ç—å (–æ—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π)
DELETE FROM farms
WHERE id NOT IN (SELECT MIN(id) FROM farms GROUP BY bin);
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ö–æ–∑—è–π—Å—Ç–≤–æ–º

```sql
-- –ù–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT u.id, u.username, u.farm_id
FROM users u
WHERE u.farm_id IS NOT NULL
  AND NOT EXISTS (SELECT 1 FROM farms f WHERE f.id = u.farm_id);

-- –ò—Å–ø—Ä–∞–≤–∏—Ç—å (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å farm_id –≤ NULL)
UPDATE users SET farm_id = NULL
WHERE farm_id IS NOT NULL
  AND NOT EXISTS (SELECT 1 FROM farms WHERE id = farm_id);
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
SELECT tablename, indexname
FROM pg_indexes
WHERE schemaname = 'public'
ORDER BY tablename, indexname;

-- –ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å–æ–≤ –º–∞–ª–æ, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ supabase_improvements.sql
```

---

## üìÅ –§–∞–π–ª—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ

### –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞:
- **SUPABASE_QUICKSTART.md** ‚Üê –≤—ã –∑–¥–µ—Å—å
- **quick_check.sql** - –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (5 –∑–∞–ø—Ä–æ—Å–æ–≤)
- **supabase_improvements.sql** - –≤—Å–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–¥–Ω–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º)

### –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è:
- **DATABASE_SCHEMA.md** - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **DATABASE_SUMMARY.md** - –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞
- **SUPABASE_SETUP.md** - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- **check_database_integrity.sql** - –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- **supabase_migration.sql** - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å –Ω—É–ª—è

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ!

### –ü–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —É–ª—É—á—à–µ–Ω–∏–π:

1. ‚úÖ –°–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã
3. ‚úÖ –û—á–∏—Å—Ç–∏—Ç–µ –¥—É–±–ª–∏–∫–∞—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. ‚úÖ –¢–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ `supabase_improvements.sql`

### –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ö–æ–∑—è–π—Å—Ç–≤–∞
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç—ã –±–æ–ª—å—à–µ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### –û—à–∏–±–∫–∞: "duplicate key value violates unique constraint"

**–ü—Ä–∏—á–∏–Ω–∞:** –í –±–∞–∑–µ —É–∂–µ –µ—Å—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `quick_check.sql`
2. –ù–∞–π–¥–∏—Ç–µ –¥—É–±–ª–∏–∫–∞—Ç—ã
3. –£–¥–∞–ª–∏—Ç–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤—Ä—É—á–Ω—É—é
4. –ü–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `supabase_improvements.sql`

### –û—à–∏–±–∫–∞: "constraint already exists"

**–ü—Ä–∏—á–∏–Ω–∞:** –£–ª—É—á—à–µ–Ω–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –º–æ–∂–µ—Ç–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
```sql
ALTER TABLE ... DROP CONSTRAINT IF EXISTS ...
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí Database ‚Üí Backups
2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω—é—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
3. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω `supabase_improvements.sql`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ `quick_check.sql` - –Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- [ ] –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (–ë–ò–ù, username, email)
- [ ] –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã (40+ –∏–Ω–¥–µ–∫—Å–æ–≤)
- [ ] CHECK constraints —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è updated_at –∞–∫—Ç–∏–≤–Ω—ã
- [ ] CASCADE DELETE –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (views) —Å–æ–∑–¥–∞–Ω—ã
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Ö–æ–∑—è–π—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –î—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

---

## üìû –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ **DATABASE_SUMMARY.md** - —Ç–∞–º –µ—Å—Ç—å –±—ã—Å—Ç—Ä—ã–µ —Ä–µ—à–µ–Ω–∏—è
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ **SUPABASE_SETUP.md** - –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `check_database_integrity.sql` - –ø–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É
