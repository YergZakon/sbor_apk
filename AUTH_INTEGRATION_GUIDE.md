# üîê Authentication Integration Guide

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∏—Å—Ç–µ–º—ã.

## ‚úÖ –£–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ

- ‚úÖ [pages/1_üè†_Dashboard.py](pages/1_üè†_Dashboard.py) - **–ì–û–¢–û–í–û**
- ‚úÖ [pages/0_üè¢_Farm_Setup.py](pages/0_üè¢_Farm_Setup.py) - **–ì–û–¢–û–í–û**
- ‚úÖ [pages/99_üîê_Login.py](pages/99_üîê_Login.py) - **–ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø** (—ç—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞)
- ‚úÖ [pages/98_‚öôÔ∏è_Admin.py](pages/98_‚öôÔ∏è_Admin.py) - **–£–ñ–ï –ï–°–¢–¨** (–∞–¥–º–∏–Ω–∫–∞)

## ‚è≥ –¢—Ä–µ–±—É—é—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- ‚è≥ [pages/2_üå±_Fields.py](pages/2_üå±_Fields.py)
- ‚è≥ [pages/3_üìù_Journal.py](pages/3_üìù_Journal.py)
- ‚è≥ [pages/4_üåæ_Sowing.py](pages/4_üåæ_Sowing.py)
- ‚è≥ [pages/5_üíä_Fertilizers.py](pages/5_üíä_Fertilizers.py)
- ‚è≥ [pages/6_üõ°Ô∏è_Pesticides.py](pages/6_üõ°Ô∏è_Pesticides.py)
- ‚è≥ [pages/7_üêõ_Phytosanitary.py](pages/7_üêõ_Phytosanitary.py)
- ‚è≥ [pages/8_üöú_Harvest.py](pages/8_üöú_Harvest.py)
- ‚è≥ [pages/9_üß™_Agrochemistry.py](pages/9_üß™_Agrochemistry.py)
- ‚è≥ [pages/11_üå§Ô∏è_Weather.py](pages/11_üå§Ô∏è_Weather.py)
- ‚è≥ [pages/15_üì•_Import.py](pages/15_üì•_Import.py)

---

## üìã –®–∞–±–ª–æ–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã

**–ù–∞–π—Ç–∏:**
```python
from modules.database import SessionLocal, Farm, Field, ...
from modules.config import settings
```

**–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ:**
```python
from modules.auth import (
    require_auth,
    require_farm_binding,
    filter_query_by_farm,
    get_user_display_name,
    can_edit_data,
    can_delete_data
)
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ù–∞–π—Ç–∏:**
```python
st.set_page_config(page_title="...", page_icon="...", layout="wide")

st.title("...")
```

**–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:**
```python
st.set_page_config(page_title="...", page_icon="...", layout="wide")

# –¢—Ä–µ–±—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ –ø—Ä–∏–≤—è–∑–∫—É –∫ —Ö–æ–∑—è–π—Å—Ç–≤—É
require_auth()
require_farm_binding()

st.title("...")
st.caption(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: **{get_user_display_name()}**")
```

### –®–∞–≥ 3: –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î

**–ù–∞–π—Ç–∏ –≤—Å–µ:**
```python
db.query(Farm).first()
db.query(Farm).all()
db.query(Field).all()
db.query(Field).filter(...)
db.query(Operation).all()
# –∏ —Ç.–¥.
```

**–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:**
```python
filter_query_by_farm(db.query(Farm), Farm).first()
filter_query_by_farm(db.query(Farm), Farm).all()
filter_query_by_farm(db.query(Field), Field).all()
filter_query_by_farm(db.query(Field).filter(...), Field)
filter_query_by_farm(db.query(Operation), Operation).all()
```

**‚ùó –í–ê–ñ–ù–û:**
- –ü—Ä–∏–º–µ–Ω—è—Ç—å –∫ –º–æ–¥–µ–ª—è–º —Å `farm_id`: Farm, Field, Operation, SowingDetail, FertilizerApplication, PesticideApplication, PhytosanitaryMonitoring, HarvestDetail, AgrochemicalAnalysis, WeatherData
- –ù–ï –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º: Crop, Variety, Fertilizer, Pesticide, Disease, Pest, Weed

### –®–∞–≥ 4: –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ù–∞–π—Ç–∏ —Å–µ–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```python
st.markdown("### ‚ûï –î–æ–±–∞–≤–∏—Ç—å...")

with st.form("..."):
    # —Ñ–æ—Ä–º–∞
```

**–û–±–µ—Ä–Ω—É—Ç—å –≤ –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤:**
```python
if can_edit_data():
    st.markdown("### ‚ûï –î–æ–±–∞–≤–∏—Ç—å...")

    with st.form("..."):
        # —Ñ–æ—Ä–º–∞
else:
    st.info("‚ÑπÔ∏è –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö")
```

**–î–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è:**
```python
if can_delete_data():
    delete_btn = st.form_submit_button("üóëÔ∏è –£–¥–∞–ª–∏—Ç—å", ...)

    if delete_btn:
        # –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
else:
    st.warning("‚ö†Ô∏è –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ")
```

### –®–∞–≥ 5: –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å JOIN –∑–∞–ø—Ä–æ—Å—ã

**–ù–∞–π—Ç–∏:**
```python
db.query(Operation, Field).join(Field).all()
db.query(Field.name, Operation.date).join(Field).all()
```

**–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:**
```python
filter_query_by_farm(
    db.query(Operation, Field).join(Field),
    Field  # –ò—Å–ø–æ–ª—å–∑—É–µ–º Field, —Ç–∞–∫ –∫–∞–∫ —É –Ω–µ–≥–æ –µ—Å—Ç—å farm_id
).all()

filter_query_by_farm(
    db.query(Field.name, Operation.date).join(Field),
    Field
).all()
```

---

## üîß –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –≥–æ—Ç–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

### Dashboard (–ì–û–¢–û–í–û)

```python
# –ò–º–ø–æ—Ä—Ç—ã
from modules.auth import require_auth, filter_query_by_farm, get_current_user, get_user_display_name

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
require_auth()

# –ó–∞–≥–æ–ª–æ–≤–æ–∫
user = get_current_user()
st.title(f"üè† Dashboard - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è")
st.caption(f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, **{get_user_display_name()}**!")

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
farms_count = filter_query_by_farm(db.query(Farm), Farm).count()
fields_count = filter_query_by_farm(db.query(Field), Field).count()
operations_count = filter_query_by_farm(db.query(Operation), Operation).count()

# JOIN –∑–∞–ø—Ä–æ—Å—ã
recent_operations = filter_query_by_farm(
    db.query(
        Operation.operation_date,
        Operation.operation_type,
        Field.name.label('field_name'),
        Operation.crop,
        Operation.area_processed_ha
    ).join(Field),
    Field
).order_by(Operation.operation_date.desc()).limit(10).all()
```

### Farm Setup (–ì–û–¢–û–í–û)

```python
# –ò–º–ø–æ—Ä—Ç—ã
from modules.auth import (
    require_auth,
    filter_query_by_farm,
    get_current_user,
    get_user_display_name,
    can_edit_data,
    can_delete_data,
    is_admin
)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
require_auth()

# –ó–∞–≥–æ–ª–æ–≤–æ–∫
st.title("üè¢ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–æ–∑—è–π—Å—Ç–≤–∞")
st.caption(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: **{get_user_display_name()}**")

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ö–æ–∑—è–π—Å—Ç–≤–∞ —Å —É—á–µ—Ç–æ–º —Ä–æ–ª–∏
user = get_current_user()
if is_admin():
    # –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å —Ö–æ–∑—è–π—Å—Ç–≤–∞
    all_farms = db.query(Farm).all()
    # ... –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞
else:
    # –§–µ—Ä–º–µ—Ä –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
    existing_farm = filter_query_by_farm(db.query(Farm), Farm).first()

# –ó–∞—â–∏—Ç–∞ –∫–Ω–æ–ø–æ–∫
if can_edit_data():
    if st.button("‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ö–æ–∑—è–π—Å—Ç–≤–∞"):
        st.session_state.edit_mode = True
else:
    st.info("‚ÑπÔ∏è –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ö–æ–∑—è–π—Å—Ç–≤–∞")

if can_delete_data():
    with st.expander("‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å —Ö–æ–∑—è–π—Å—Ç–≤–æ (–æ–ø–∞—Å–Ω–æ!)"):
        # ... –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
```

---

## üéØ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### Fields (–ü–æ–ª—è)

- ‚úÖ –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å: `db.query(Field).filter(Field.farm_id == farm.id)`
- ‚úÖ –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è
- ‚úÖ –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—è
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

### Journal (–ñ—É—Ä–Ω–∞–ª –æ–ø–µ—Ä–∞—Ü–∏–π)

- ‚úÖ –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ–ª—è–º —Ö–æ–∑—è–π—Å—Ç–≤–∞
- ‚úÖ JOIN —Å Field –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### Sowing, Fertilizers, Pesticides, Harvest (–ê–≥—Ä–æ–æ–ø–µ—Ä–∞—Ü–∏–∏)

- ‚úÖ –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –¥–ª—è –≤—ã–±–æ—Ä–∞
- ‚úÖ –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—ã –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (–∫—É–ª—å—Ç—É—Ä—ã, —É–¥–æ–±—Ä–µ–Ω–∏—è, –ø–µ—Å—Ç–∏—Ü–∏–¥—ã) - –ù–ï —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å

### Phytosanitary (–§–∏—Ç–æ—Å–∞–Ω–∏—Ç–∞—Ä–∏—è)

- ‚úÖ –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∏ –ø–æ –ø–æ–ª—è–º —Ö–æ–∑—è–π—Å—Ç–≤–∞
- ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (–±–æ–ª–µ–∑–Ω–∏, –≤—Ä–µ–¥–∏—Ç–µ–ª–∏, —Å–æ—Ä–Ω—è–∫–∏) - –ù–ï —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å

### Agrochemistry (–ê–≥—Ä–æ—Ö–∏–º–∏—è)

- ‚úÖ –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑—ã –ø–æ –ø–æ–ª—è–º —Ö–æ–∑—è–π—Å—Ç–≤–∞

### Weather (–ü–æ–≥–æ–¥–∞)

- ‚úÖ –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –º–µ—Ç–µ–æ–¥–∞–Ω–Ω—ã–µ –ø–æ —Ö–æ–∑—è–π—Å—Ç–≤—É
- ‚úÖ –¢–æ–ª—å–∫–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### Import (–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö)

- ‚úÖ –ò–º–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ –≤ —Å–≤–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –ø–æ–ª–µ–π
- ‚ùó –í–ê–ñ–ù–û: –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –ª—é–±–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
   ```bash
   python create_admin.py  # –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∞
   # –ó–∞—Ç–µ–º —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É —Å–æ–∑–¥–∞—Ç—å 2 —Ñ–µ—Ä–º–µ—Ä–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ö–æ–∑—è–π—Å—Ç–≤–∞–º–∏
   ```

2. **–¢–µ—Å—Ç –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:**
   - –í–æ–π—Ç–∏ –∫–∞–∫ –§–µ—Ä–º–µ—Ä 1, –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ/–æ–ø–µ—Ä–∞—Ü–∏—é
   - –í–æ–π—Ç–∏ –∫–∞–∫ –§–µ—Ä–º–µ—Ä 2, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –§–µ—Ä–º–µ—Ä–∞ 1 –Ω–µ –≤–∏–¥–Ω—ã
   - –í–æ–π—Ç–∏ –∫–∞–∫ –ê–¥–º–∏–Ω, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–∏–¥–Ω—ã –í–°–ï –¥–∞–Ω–Ω—ã–µ

3. **–¢–µ—Å—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞:**
   - –í–æ–π—Ç–∏ –∫–∞–∫ Viewer, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ—Ç –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –í–æ–π—Ç–∏ –∫–∞–∫ –§–µ—Ä–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –í–æ–π—Ç–∏ –∫–∞–∫ –ê–¥–º–∏–Ω, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –≤–∫–ª—é—á–∞—è —É–¥–∞–ª–µ–Ω–∏–µ

4. **–¢–µ—Å—Ç JOIN –∑–∞–ø—Ä–æ—Å–æ–≤:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Dashboard —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Journal —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –æ—Ç—á–µ—Ç—ã

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –∏–∑ modules.auth
- [ ] –î–æ–±–∞–≤–ª–µ–Ω `require_auth()` –ø–æ—Å–ª–µ `st.set_page_config()`
- [ ] –î–æ–±–∞–≤–ª–µ–Ω `require_farm_binding()` (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ö–æ–∑—è–π—Å—Ç–≤—É)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω caption —Å –∏–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Ç–∞–±–ª–∏—Ü–∞–º —Å farm_id –æ–±–µ—Ä–Ω—É—Ç—ã –≤ `filter_query_by_farm()`
- [ ] –§–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–µ—Ä–Ω—É—Ç—ã –≤ `if can_edit_data():`
- [ ] –ö–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –æ–±–µ—Ä–Ω—É—Ç—ã –≤ `if can_delete_data():`
- [ ] JOIN –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏
- [ ] –ù–µ—Ç —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ö–æ–∑—è–π—Å—Ç–≤–∞–º–∏

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ –æ—Å—Ç–∞–≤—à–∏–º—Å—è 10 —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Streamlit Cloud
5. –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
6. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìö –°–ø—Ä–∞–≤–∫–∞ –ø–æ —Ñ—É–Ω–∫—Ü–∏—è–º

### require_auth()
–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω.

### require_farm_binding()
–¢—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Ö–æ–∑—è–π—Å—Ç–≤—É (–∫—Ä–æ–º–µ –∞–¥–º–∏–Ω–æ–≤). –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω.

### filter_query_by_farm(query, model)
–§–∏–ª—å—Ç—Ä—É–µ—Ç SQLAlchemy query –ø–æ —Ö–æ–∑—è–π—Å—Ç–≤—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏:
- **–ê–¥–º–∏–Ω** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç query –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–≤–∏–¥–∏—Ç –≤—Å—ë)
- **–§–µ—Ä–º–µ—Ä/Viewer** - –¥–æ–±–∞–≤–ª—è–µ—Ç `.filter(model.farm_id == user.farm_id)`
- **–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `.filter(False)` (–ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)

### can_edit_data()
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `True` –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ –∏ —Ñ–µ—Ä–º–µ—Ä–æ–≤.

### can_delete_data()
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `True` —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤.

### get_user_display_name()
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (full_name –∏–ª–∏ username).

### is_admin()
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-15
**–í–µ—Ä—Å–∏—è:** 2.0.0
**–°—Ç–∞—Ç—É—Å:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
